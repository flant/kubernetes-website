---
reviewers:
title: Управление ресурсами на узлах под управлением ОС Windows
content_type: concept
weight: 75
---

<!-- overview -->

На этой странице описаны различия в управлении ресурсами в Linux и Windows.

<!-- body -->

На узлах под управлением Linux для контроля за потреблением ресурсов Pod'а используются {{< glossary_tooltip text="контрольные группы" term_id="cgroup" >}} (cgroups). Они обеспечивают изоляцию контейнеров на уровне сети, процессов и файловой системы. API контрольных групп Linux можно использовать для сбора статистики использования CPU, операций ввода-вывода и памяти.

В свою очередь Windows каждому контейнеру сопоставляет [_объект job_](https://docs.microsoft.com/windows/win32/procthread/job-objects) с системной фильтрацией по пространствам имен. Это позволяет локализовать все процессы в контейнере и обеспечивает логическую изоляции от хоста. (Объекты Job – механизм изоляции процессов в Windows; они не имеют ничего общего с {{< glossary_tooltip term_id="job" text="Job'ами" >}}) в Kubernetes.

Контейнер в Windows невозможно запустить без фильтрации по пространствам имен. В результате системные привилегии невозможно задать на уровне хоста, то есть привилегированные контейнеры недоступны в Windows.
Контейнеры не могут перенимать идентификацию от хоста из-за обособленности диспетчера учетных записей безопасности (SAM).

## Управление ресурсами памяти  {#resource-management-memory}

В отличие от Linux, в Windows нет OOM-убийцы процессов. Windows всегда рассматривает все распределения памяти в пользовательском режиме как виртуальные, и файлы подкачки (pagefiles) являются обязательными.

Узлы Windows не допускают выделения памяти процессам с избытком (overcommit). Таким образом, Windows, в отличие от Linux, не сталкивается с недостатком памяти (OOM) для процессов, а просто выгружает их на диск вместо того, чтобы "убить" по OOM. Подкачка может замедлить производительность в случае, если вся физическая память исчерпана.

## Управление ресурсами CPU {#resource-management-cpu}

Windows может ограничивать количество процессорного времени, выделяемого для различных процессов, но не может гарантировать его минимум.

В Windows kubelet поддерживает флаг командной строки, который позволяет установить [приоритет планирования](https://docs.microsoft.com/windows/win32/procthread/scheduling-priorities) процесса kubelet: `--windows-priorityclass`. Этот флаг позволяет kubelet'у получать больше процессорного времени по сравнению с другими процессами, работающими на хосте Windows. Более подробную информацию о допустимых значениях и их смысле можно найти в разделе [Классы приоритетов в Windows](https://docs.microsoft.com/en-us/windows/win32/procthread/scheduling-priorities#priority-class). Чтобы гарантировать, что работающие Pod'ы не смогут лишить kubelet ресурсов процессора, установите этот флаг в `ABOVE_NORMAL_PRIORITY_CLASS` или выше.

## Резервирование ресурсов {#resource-reservation}

Чтобы учесть память и CPU, используемые операционной системой, средой исполнения для контейнера и процессами хоста Kubernetes, такими как kubelet, можно (и нужно) резервировать ресурсы памяти и CPU с помощью флагов `--kube-reserved` и/или `--system-reserved kubelet`. В Windows эти значения используются только для расчета ресурсов узла, [доступных для распределения](/docs/tasks/administer-cluster/reserve-compute-resources/#node-allocatable).

{{< caution >}}
Развертывая рабочие нагрузки, задавайте ограничения памяти ресурсов и процессора для контейнеров. Они будут вычитаться из `NodeAllocatable`, помогая планировщику кластера определять, какие Pod'ы на каких узлах размещать.

Планирование Pod'ов без заданных ограничений может привести к избыточному потреблению ресурсов на Windows-узлах и в крайних случаях к их неработоспособности.
{{< /caution >}}

В Windows рекомендуется резервировать не менее 2 GiB памяти.

Чтобы определить, сколько CPU необходимо зарезервировать, определите максимальную плотность Pod'ов для каждого узла и отследите использование CPU работающими на этом узле системными службами, а затем выберите значение, соответствующее потребностям рабочей нагрузки.
